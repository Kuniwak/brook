Namespace("brook").define(function(e){var t="0.01",n=function(e){this.next=e||function(e,t){return e(t)}};(function(e){e.concat=function(e){var t=this,r=function(n,r){return t.subscribe(e.ready(n),r)};return new n(r)},e.bind=function(){var e=this;for(var t=0,i=arguments.length;t<i;t++){var s=arguments[t];s=s instanceof n?s:r(s),e=e.concat(s)}return e},e.ready=function(e){var t=this;return function(n){return t.subscribe(e,n)}},e.run=function(e){this.subscribe(undefined,e)},e.subscribe=function(e,t){e=e?e:function(){};if(!this.errorHandler)return this.next(e,t);try{this.next(e,t)}catch(n){this.onError(n)}},e.forEach=e.subscribe,e.setErrorHandler=function(e){this.errorHandler=e},e.onError=function(e){(this.errorHandler||new n).subscribe(function(){},e)}})(n.prototype);var r=function(e){return new n(e)};e.provide({promise:r,VERSION:t})}),Namespace("brook.util").use("brook promise").define(function(e){var t=function(t){return e.promise(function(e,n){return e(t(n))})},n=function(t){return e.promise(function(e,n){return t(n),e(n)})},r=function(t){return e.promise(function(e,n){if(t(n))return e(n)})},i=function(t){var n=1,r=[];return e.promise(function(e,i){r.push(i),n++%t===0&&(e(r),r=[])})},s=Date.now?function(){return Date.now()}:function(){return+(new Date)},o=function(e,t){for(var n=0,r=e.length;n<r;n++)t(e[n])},u=function(e,t,n){var r=0,i=e.length;(function(){var o=s();while(i>r&&n>s()-o)t(e[r++]);i>r&&setTimeout(arguments.callee,10)})()},a=function(e){return function(t,n){u(t,n,e)}},f=function(t){var n=t?a(t):o;return e.promise(function(e,t){n(t,e)})},l=function(t){var n=typeof t=="function"?t:function(){return t};return e.promise(function(e,t){setTimeout(function(){e(t)},n())})},c=function(t){var n=function(e,r){if(t())return e(r);setTimeout(function(){n(e,r)},100)};return e.promise(n)},h=function(e){return e=e?e:"debug",n(function(t){console.log(e+":",t)})},p=function(t,n){return e.promise(function(e,r){if(!t(r))return e(r);n.subscribe(function(t){return e(t)},r)})},d=function(t,n){return e.promise(function(r,i){var s;n&&(s=t[n(i)]),s||(s=t[i]||t.__default__||e.promise()),s.subscribe(function(e){r(e)},i)})},v={},m=function(t){return e.promise(function(e,n){v[t]=!1,e(n)})},g=function(t){var n=function(e,r){if(!v[t])return v[t]=!0,e(r);setTimeout(function(){n(e,r)},100)};return e.promise(n)},y=function(t){return t.observe?e.promise(function(n,r){t.observe(e.promise(function(e,t){n(t)}))}):e.promise(function(e,n){e(t)})},b={},w=function(t,n){var r=typeof t=="function"?t:function(){return t};return e.promise(function(e,t){var i=setInterval(function(){e(t)},r());n&&(b[n]=i)})},E=function(t){return e.promise(function(e,n){clearInterval(b[t]),e(n)})};e.provide({mapper:t,through:n,filter:r,scatter:f,takeBy:i,wait:l,cond:p,match:d,debug:h,lock:g,unlock:m,from:y,waitUntil:c,emitInterval:w,stopEmitInterval:E})}),Namespace("brook.lambda").define(function(e){var t={},n=function(e){return e.indexOf("->")>=0},r=function(e){var t=n(e)?e:"$->"+e,r=t.split("->"),s=r.shift(),o=r.join("->");return{argumentNames:s.split(","),body:n(o)?i(o).toString():o}},i=function(e){if(t[e])return t[e];var n=r(e),i=new Function(n.argumentNames,"return ("+n.body+");");return t[e]=i,i};e.provide({lambda:i})}),Namespace("brook.channel").use("brook promise").use("brook.util scatter").define(function(e){var t=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1},n=function(){this.queue=[],this.promises=[]};(function(n){var r=function(e){return e};n.send=function(t){t=t?t:r;var n=this;return e.promise(function(e,r){n.sendMessage(t(r)),e(r)})},n.sendMessage=function(t){var n=e.scatter(1e3),r=a("error");this.queue.push(t);var i=function(t){return e.promise(function(e,n){n.run(t)})};while(this.queue.length){var s=this.queue.shift(),o=i(s);o.setErrorHandler(r),n.bind(o).run(this.promises)}},n.observe=function(e){if(t(this.promises,e)>-1)return;this.promises.push(e)},n.stopObserving=function(e){var n=t(this.promises,e);n>-1&&this.promises.splice(n,1)}})(n.prototype);var r=function(e){return e?s(e):new n},i={},s=function(e){return i[e]?i[e]:(i[e]=new n,i[e])},o=function(e,t){s(e).observe(t)},u=function(e,t){s(e).stopObserving(t)},a=function(e,t){var n=s(e);return n.send(t)};e.provide({channel:r,sendChannel:a,observeChannel:o,stopObservingChannel:u,createChannel:function(){return new n}})}),Namespace("brook.model").use("brook promise").use("brook.util *").use("brook.channel *").use("brook.lambda *").define(function(e){var t=function(e){this.methods={},this.channels={};for(var t in e){if(!e.hasOwnProperty(t))continue;this.addMethod(t,e[t])}};t.prototype.addMethod=function(t,n){if(this.methods[t])throw"already "+t+" defined";var r=e.createChannel();return this.methods[t]=n.bind(r.send()),this.channels[t]=r,this},t.prototype.notify=function(t){return e.promise().bind(this.methods[t])},t.prototype.method=function(e){if(!this.channels[e])throw"do not observe undefined method";return this.channels[e]};var n=function(e){return new t(e)};e.provide({createModel:n})}),Namespace("brook.view.htmltemplate.core").define(function(e){var t={exports:{}},n={};n.defineClass=function(e,t){var n=function(){this.initialize.apply(this,arguments)};t&&(n.prototype=new t);for(var r in e){if(!e.hasOwnProperty(r))continue;n.prototype[r]=e[r]}return n.prototype.initialize||(n.prototype.initalize=function(){}),n},n.merge=function(e,t){for(var n in t){if(!t.hasOwnProperty(n))continue;e[n]=t[n]}},n.k=function(e){return e},n.emptyFunction=function(){},n.listToArray=function(e){return Array.prototype.slice.call(e)},n.curry=function(){var e=n.listToArray(arguments),t=e.shift();return function(){return t.apply(this,e.concat(n.listToArray(arguments)))}},n.merge(n,{isArray:function(e){return e!==null&&typeof e=="object"&&"splice"in e&&"join"in e},isFunction:function(e){return typeof e=="function"},isString:function(e){return typeof e=="string"},isNumber:function(e){return typeof e=="number"},isUndefined:function(e){return typeof e=="undefined"}}),n.createRegexMatcher=function(e,t){function r(t){return(t+"").replace(new RegExp(e,"g"),"\\")}var i=0,s,o={mapping:{fullText:[0]},text:[]};for(var u=0,a=t.length;u<a;u++){s=t[u];if(n.isString(s)){o.text.push(s);continue}o.mapping[s.map]||(o.mapping[s.map]=[]),o.mapping[s.map].push(++i)}var f;return o.text=r(o.text.join("")),function(t){f||(f=new RegExp(o.text));var n=(t||"").match(f);if(n){var r={},i=0,s=0,u=o.mapping;for(i in u){var a=u[i],l=a.length;for(s=0;s<l;s++)if(n[a[s]]){r[i]=n[a[s]];break}}return r}return undefined}};var r=n.createRegexMatcher("%",["<","(%/)?",{map:"close"},"TMPL_","(VAR|LOOP|IF|ELSE|ELSIF|UNLESS|INCLUDE)",{map:"tag_name"},"%s*","(?:","(?:DEFAULT)=","(?:","'([^'>]*)'|",{map:"default"},'"([^">]*)"|',{map:"default"},"([^%s=>]*)",{map:"default"},")",")?","%s*","(?:","(?:ESCAPE)=","(?:","(JS|URL|HTML|0|1|NONE)",{map:"escape"},")",")?","%s*","(?:","(?:DEFAULT)=","(?:","'([^'>]*)'|",{map:"default"},'"([^">]*)"|',{map:"default"},"([^%s=>]*)",{map:"default"},")",")?","%s*","(?:","(NAME|EXPR)=",{map:"attribute_name"},"(?:","'([^'>]*)'|",{map:"attribute_value"},'"([^">]*)"|',{map:"attribute_value"},"([^%s=>]*)",{map:"attribute_value"},")",")?","%s*","(?:","(?:DEFAULT)=","(?:","'([^'>]*)'|",{map:"default"},'"([^">]*)"|',{map:"default"},"([^%s=>]*)",{map:"default"},")",")?","%s*","(?:","(?:ESCAPE)=","(?:","(JS|URL|HTML|0|1|NONE)",{map:"escape"},")",")?","%s*","(?:","(?:DEFAULT)=","(?:","'([^'>]*)'|",{map:"default"},'"([^">]*)"|',{map:"default"},"([^%s=>]*)",{map:"default"},")",")?","%s*",">"]),i={};i.Base=n.defineClass({initialize:function(e){this.mergeOption(e)},mergeOption:function(e){n.merge(this,e),this.isCloseTag=this.isCloseTag?!0:!1},isParent:n.emptyFunction,execute:n.emptyFunction,getCode:function(e){return"void(0);"},toString:function(){return["<",this.isCloseTag?"/":"",this.type,this.hasName?" NAME=":"",this.name?this.name:"",">"].join("")},_pathLike:function(e,t){var n=t=="/"?"0":"$_C.length -"+(t.split("..").length-1);return["(($_C["+n+"]['",e,"']) ? $_C["+n+"]['",e,"'] : undefined )"].join("")},getParam:function(){var e="";if(this.attributes.name){var t=this.attributes.name.match(/^(\/|(?:\.\.\/)+)(\w+)/);if(t)return this._pathLike(t[2],t[1]);var n=this.attributes["default"]?"'"+this.attributes["default"]+"'":"undefined";e=["(($_T['",this.attributes.name,"']) ? $_T['",this.attributes.name,"'] : ",n," )"].join("")}if(this.attributes.expr){var r={gt:">",lt:"<",eq:"==",ne:"!=",ge:">=",le:"<="},i=this.attributes.expr.replace(/\{(\/|(?:\.\.\/)+)(\w+)\}/g,function(e,t,n){return["$_C[",t=="/"?"0":"$_C.length -"+(t.split("..").length-1),']["',n,'"]'].join("")}).replace(/\s+(gt|lt|eq|ne|ge|le|cmp)\s+/g,function(e,t){return" "+r[t]+" "});e=["(function(){","    with($_F){","        with($_T){","            return (",i,");","}}})()"].join("")}if(this.attributes.escape){var s={NONE:"NONE",0:"NONE",1:"HTML",HTML:"HTML",JS:"JS",URL:"URL"}[this.attributes.escape];e=["$_F.__escape"+s+"(",e,")"].join("")}return e}});var s={STRING_FRAGMENT:[]};n.merge(i,{ROOTElement:n.defineClass({type:"root",getCode:function(){return this.isCloseTag?'return $_R.join("");':["var $_R  = [];","var $_C  = [param];","var $_F  = funcs||{};","var $_T  = param||{};","var $_S  = cache.STRING_FRAGMENT;"].join("")}},i.Base),LOOPElement:n.defineClass({type:"loop",initialize:function(e){this.mergeOption(e)},getLoopId:function(){if(this._ID)return this._ID;i.LOOPElement.instanceId||(i.LOOPElement.instanceId=0);var e=i.LOOPElement.instanceId++;return this._ID="$"+e.toString(16),this._ID},getCode:function(){if(this.isCloseTag)return["}","$_T = $_C.pop();"].join("");var e=this.getLoopId();return["var $_L_"+e+" ="+this.getParam()+"|| [];","var $_LL_"+e+" = $_L_"+e+".length;","$_C.push($_T);","for(var i_"+e+"=0;i_"+e+"<$_LL_"+e+";i_"+e+"++){","   $_T = (typeof $_L_"+e+"[i_"+e+'] == "object")?',"                $_L_"+e+"[i_"+e+"] : {};","$_T['__first__'] = (i_"+e+" == 0) ? true: false;","$_T['__counter__'] = i_"+e+"+1;","$_T['__odd__']   = ((i_"+e+"+1)% 2) ? true: false;","$_T['__last__']  = (i_"+e+" == ($_LL_"+e+" - 1)) ? true: false;","$_T['__inner__'] = ($_T['__first__']||$_T['__last__'])?false:true;"].join("")}},i.Base),VARElement:n.defineClass({type:"var",getCode:function(){if(this.isCloseTag)throw new Error("HTML.Template ParseError TMPL_VAR");return"$_R.push("+this.getParam()+");"}},i.Base),IFElement:n.defineClass({type:"if",getCondition:function(e){return"!!"+this.getParam(e)},getCode:function(){return this.isCloseTag?"}":"if("+this.getCondition()+"){"}},i.Base),ELSEElement:n.defineClass({type:"else",getCode:function(){if(this.isCloseTag)throw new Error("HTML.Template ParseError No Close Tag for TMPL_ELSE");return"}else{"}},i.Base),INCLUDEElement:n.defineClass({type:"include",getCode:function(){if(this.isCloseTag)throw new Error("HTML.Template ParseError No Close Tag for TMPL_INCLUDE");var e='"'+this.attributes.name+'"';return["$_R.push($_F.__include(",e,",$_T,$_F));"].join("\n")}},i.Base),TEXTElement:n.defineClass({type:"text",isCloseTag:!1,initialize:function(e){this.value=e},getCode:function(){if(this.isCloseTag)throw new Error("HTML.Template ParseError No Close Tag for TEXT");return s.STRING_FRAGMENT.push(this.value),"$_R.push($_S["+(s.STRING_FRAGMENT.length-1)+"]);"}},i.Base)}),i.ELSIFElement=n.defineClass({type:"elsif",getCode:function(){if(this.isCloseTag)throw new Error("HTML.Template ParseError No Close Tag for TMPL_ELSIF");return"}else if("+this.getCondition()+"){"}},i.IFElement),i.UNLESSElement=n.defineClass({type:"unless",getCondition:function(e){return"!"+this.getParam(e)}},i.IFElement),i.createElement=function(e,t){return new i[e+"Element"](t)};var o=function(e){var t=[],n=i.createElement,s=n("ROOT",{isCloseTag:!1}),o=r;t.push(s);while(e.length>0){var u=o(e);if(!u){t.push(n("TEXT",e)),e="";break}var a=0,f=u.fullText;if((a=e.indexOf(f))>0){var l=e.slice(0,a);t.push(n("TEXT",l)),e=e.slice(a)}var c,h,p;u.attribute_name?(h=u.attribute_name.toLowerCase(),p=u.attribute_value,c={},c[h]=p,c["default"]=u["default"],c.escape=u.escape):c=undefined,t.push(n(u.tag_name,{attributes:c,isCloseTag:u.close,parent:this})),e=e.slice(f.length)}return t.push(n("ROOT",{isCloseTag:!0})),t};t.exports.getFunctionText=function(e){var t=n.isString(e)?o(e):e,r=[];for(var i=0,s=t.length;i<s;i++)r.push(t[i].getCode());return r.join("\n")},t.exports.compileFunctionText=function(e){return n.curry(new Function("cache","param","funcs",e),s)},e.provide(t.exports)}),Namespace("brook.view.htmltemplate").use("brook.view.htmltemplate.core *").define(function(e){var t=function(e,t){for(var n in t){if(!t.hasOwnProperty(n))continue;e[n]=t[n]}},n={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},r=function(e,t){var n=[];for(var r=0,i=e.length;r<i;r++)n.push(t(e[r]));return n},i=function(e){return'"'+r(e.split(""),function(e){return n[e]?n[e]:e}).join("")+'"'},s={__escapeHTML:function(e){return e.toString().replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#039;").replace(/"/g,"&quot;")},__escapeJS:function(e){return i(e)},__escapeURL:function(e){return encodeURI(e)},__escapeNONE:function(e){return e},__include:function(e,t,n){var r=o.getByElementId(e);if(!r)return;return r.param(t),r.registerFunction(n),r.output()}},o=function(n){this._param={},this._funcs={},t(this._funcs,s),this._output=n};t(o.prototype,{param:function(e){t(this._param,e)},registerFunction:function(e,t){this._funcs[e]=t},output:function(){return this._output(this._param,this._funcs)}});var u="Node"in window?Node.COMMENT_NODE:8,a=function(e){var t=e.childNodes||[],n=[];for(var r=0,i=t.length;r<i;r++){var s=t[r];if(s.nodeType!=u)continue;n.push(s.data)}return n.join("")},f=function(t){return e.getFunctionText(a(t))};t(o,{cache:{},get:function(t){var n="autocache:"+o.hashFunction(t),r=o.resolve(n);if(r)return new o(r);var i=e.getFunctionText(t),s=e.compileFunctionText(i);return new o(o.reserve(n,s))},resolve:function(e){return o.cache[e]},reserve:function(e,t){return o.cache[e]=t,o.cache[e]},getByElementId:function(t){var n="dom:"+t,r=o.resolve(n);if(r)return new o(r);var i=document.getElementById(t);if(!i)return undefined;var s=f(i),u=e.compileFunctionText(s);return new o(o.reserve(n,u))},hashFunction:function(e){var t=1<<31,n=e.length,r=34351,i="x";for(var s=0;s<n;s++){var o=e.charCodeAt(s);r*=37,i^=o,r+=o,r%=t}return r.toString(16)+"-"+(i&255).toString(16)},registerFunction:function(e,t){s[e]=t}}),e.provide({HTMLTemplate:o})}),Namespace("brook.dom.compat").define(function(e){var t=function(){var e=function(e){return e.dataset};if("HTMLElement"in window&&HTMLElement.prototype){var t=HTMLElement.prototype;if(t.dataset)return e;if(t.__lookupGetter__&&t.__lookupGetter__("dataset"))return e}var n=function(e){return e.replace(/-+(.)?/g,function(e,t){return t?t.toUpperCase():""})};return function(e){var t={};for(var r=0,i=e.attributes,s=i.length;r<s;r++){var o=i[r];if(!o.name.match(/^data-/))continue;t[n(o.name.replace(/^data-/,""))]=o.value}return t}}(),n=function(e){this._element=e,this._refresh()},r=function(e){return new n(e)};(function(e){var t=function(e){if(e==="")throw"SYNTAX_ERR";if(e.indexOf(/\s/)!=-1)throw"INVALID_CHARACTER_ERR"};this._fake=!0,this._refresh=function(){var e=(this._element.className||"").split(/\s+/);return e.length&&e[0]===""&&e.shift(),e.length&&e[e.length-1]===""&&e.pop(),this._classList=e,this.length=e.length,this},this.item=function(e){return this._classList[e]||null},this.contains=function(e){t(e);for(var n=0;n<this.length;++n)if(this._classList[n]==e)return!0;return!1},this.add=function(e){t(e);for(var n=0;n<this.length;++n)if(this._classList[n]==e)return;this._classList.push(e),this.length=this._classList.length,this._element.className=this._classList.join(" ")},this.remove=function(e){t(e);for(var n=0;n<this._classList.length;++n)this._classList[n]==e&&(this._classList.splice(n,1),this._element.className=this._classList.join(" "));this.length=this._classList.length},this.toggle=function(e){t(e);for(var n=0;n<this.length;++n)if(this._classList[n]==e)return this.remove(e),!1;return this.add(e),!0}}).apply(n.prototype);var i=function(e,t){var n=e.className;return!n||!t?!1:(new RegExp("(^|\\s)"+t+"(\\s|$)")).test(n)},s=function(e){if(document.getElementsByClassName)return document.getElementsByClassName(e);var t=document.getElementsByTagName("*"),n=[];for(var r=0,s=t.length;r<s;r++){if(!i(t[r],e))continue;n.push(t[r])}return n};e.provide({getElementsByClassName:s,hasClassName:i,dataset:t,classList:r})}),Namespace("brook.dom.gateway").define(function(e){e.provide({})}),Namespace("brook.widget").use("brook promise").use("brook.channel *").use("brook.util *").use("brook.dom.compat *").define(function(e){var t="widget",n=e.classList,r=e.dataset,i=e.channel("widget"),s=e.channel("error"),o=function(e,t){n(t).remove(e)},u=e.promise(function(n,r){r=r||t,n([r,Array.prototype.slice.call(e.getElementsByClassName(r))])}),a=e.promise(function(e,n){var i=n[0],s=n[1],u={};for(var a=0,f=s.length;a<f;a++){var l=s[a];o(i||t,l);var c=r(l),h=c.widgetNamespace;if(!h)continue;u[h]||(u[h]=[]),u[h].push([l,c])}e(u)}),f=e.promise(function(e,t){var n=[];for(var r in t)t.hasOwnProperty(r)&&n.push([r,t[r]]);e(n)}),l=e.promise(function(e,t){Namespace.use([t[0],"*"].join(" ")).apply(function(n){e([n,t[1]])})}),c=e.promise(function(e,t){var n=t[0],r=t[1],i,o;try{if(n.registerElement)for(i=0,o=r.length;i<o;i++)n.registerElement.apply(null,r[i]);else{if(!n.registerElements)throw"registerElement or registerElements not defined in "+n.CURRENT_NAMESPACE;var u=[];for(i=0,o=r.length;i<o;i++)u.push(r[i][0]);n.registerElements(u)}}catch(a){s.sendMessage(a)}}),h=e.promise().bind(e.lock("class-seek"),u,a,f,e.unlock("class-seek"),e.scatter(),l,c);i.observe(h),e.provide({bindAllWidget:i.send()})}),Namespace("brook.dom.event").use("brook promise").define(function(e){});